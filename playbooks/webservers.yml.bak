---

- name: servery nginx
  hosts: webservers
  become: True
  tasks:
    - name: Sprawdzenie czy nginx zainstalowany
      package: name=nginx update_cache=yes

    - name: Skopiuj config
      copy:
        src: nginx.conf
        dest: /etc/nginx/sites-available/default

    - name: Konfiguracja
      file: >
        dest=/etc/nginx/sites-enabled/default
        src=/etc/nginx/sites-available/default
        state=link

    - name: Kopia index.html
      template: >
        src=index.html.j2
        dest=/usr/share/nginx/html/index.html

    - name: Check if vagrant.ini file exists
      stat:
        path: /home/qql/Documents/tutorials/ansible/inventory/vagrant.ini

#path: /path/to/vagrant.ini
      register: file_stat

    - name: Update vagrant.ini file if it exists
      lineinfile:
        path: /home/qql/Documents/tutorials/ansible/inventory/vagrant.ini
        #path: /path/to/vagrant.ini
        line: "{{ item.line }}"
      loop:
        - line: "[webservers]"
        - line: "ORKUZ ansible_port=2222"
        - line: ""
        - line: "[webservers:vars]"
        - line: "ansible_host=127.0.0.1"
        - line: "ansible_user=vagrant"
        - line: "ansible_private_key_file=.vagrant/machines/default/libvirt/private_key"
      when: file_stat.stat.exists

    - name: Restart Nginx
      service:
        name: nginx
        state: restarted
       
          #- name: Verify file existence and update vagrant.ini
          #     hosts: webservers
          #     gather_facts: false

